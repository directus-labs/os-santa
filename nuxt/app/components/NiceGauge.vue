<script setup lang="ts">
import { useSound } from '@vueuse/sound';

import ding from '~/assets/audio/ding.mp3';

const props = defineProps<{
	list: 'nice' | 'naughty';
	animate: boolean;
}>();

const emit = defineEmits<{
	(e: 'animation-completed'): void;
}>();

const finalRotation = computed(() => (props.list === 'nice' ? 45 : -45));
const isAnimating = ref(true);

// Track current rotation for highlighting panels
const currentRotation = ref(0);

// Swing animation
const needleStyle = computed(() => ({
	transform: `rotate(${isAnimating.value ? currentRotation.value : finalRotation.value}deg)`,
	transformOrigin: '429.89px 449.34px',
	transition: isAnimating.value ? 'none' : 'transform 2s cubic-bezier(0.34, 1.56, 0.64, 1)',
}));

// Determine which panel to highlight based on current rotation
const isOverNice = computed(() => currentRotation.value > 0);
const isOverNaughty = computed(() => currentRotation.value < 0);

// Panel opacity styles
const nicePanelStyle = computed(() => ({
	opacity: isAnimating.value ? (isOverNice.value ? 1 : 0.3) : props.list === 'nice' ? 1 : 0.3,
	transition: 'opacity 0.3s',
}));

const naughtyPanelStyle = computed(() => ({
	opacity: isAnimating.value ? (isOverNaughty.value ? 1 : 0.3) : props.list === 'naughty' ? 1 : 0.3,
	transition: 'opacity 0.3s',
}));

const { play: playDing } = useSound(ding, {
	interrupt: true,
});

const soundOn = useCookie('soundOn');

// Initialize audio on mount
onMounted(() => {
	if (props.animate) {
		let startTime = Date.now();
		const duration = 3000; // 3 seconds
		const swingAmplitude = 60; // Maximum swing angle
		const frequency = 5; // Number of swings

		function animate() {
			const elapsed = Date.now() - startTime;

			if (elapsed < duration) {
				// Decreasing amplitude over time
				const dampening = 1 - elapsed / duration;
				const angle = Math.sin((elapsed / duration) * Math.PI * frequency) * swingAmplitude * dampening;
				currentRotation.value = angle;
				requestAnimationFrame(animate);
			} else {
				isAnimating.value = false;

				// Play sound if enabled
				if (soundOn.value) {
					playDing();
				}

				emit('animation-completed');
			}
		}

		animate();
	}
});

// Toggle sound function
function toggleSound() {
	isSoundEnabled.value = !isSoundEnabled.value;
}
</script>

<template>
	<svg id="Layer_2" data-name="Layer 2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 863.1 537.94">
		<g id="Layer_1-2" data-name="Layer 1">
			<g id="gauge-background">
				<path
					class="cls-8"
					d="M431.5,0C193.2,0,0,193.2,0,431.5s0,1.9,0,2.8c.1,21.6,18,37.7,38.5,37.7h786.1c20.5,0,38.3-16.1,38.5-37.7v-2.8C863.1,193.2,669.9,0,431.6,0h-.1Z"
				/>
				<path
					class="cls-1"
					d="M824.5,455c11.7,0,21.4-9.1,21.5-20.8v-2.7c0-228.9-185.6-414.5-414.5-414.5S17,202.6,17,431.5s0,1.8,0,2.7c0,11.7,9.8,20.8,21.5,20.8h786.1-.1Z"
				/>
			</g>
			<g id="nice-panel" :style="nicePanelStyle">
				<g>
					<path
						class="cls-7"
						d="M439.6,253.7c0,9.4,7.2,17.1,16.5,18.8,69.1,12.8,122.7,69.7,130.5,140.3,1.1,9.9,9.1,18,19,18h193c9.9,0,18-8.1,17.6-18-8.9-196.5-163.3-355.1-358-370.7-10.1-.8-18.6,7.4-18.6,17.6v194.1-.1Z"
					/>
					<g class="cls-11">
						<path
							class="cls-6"
							d="M456.8,49h.8c92.6,7.4,179.3,48.4,244.2,115.4,65,67.2,103.1,155.5,107.4,248.7.1,2.8-.9,5.4-2.8,7.4-2,2.1-4.9,3.3-7.8,3.3h-193c-6.1,0-11.3-5-12-11.7-2-18.1-6.9-35.6-14.6-52.1-7.5-16-17.4-30.8-29.5-43.8s-26.1-23.9-41.5-32.4c-15.8-8.8-32.8-14.9-50.6-18.1-6.2-1.2-10.7-6.2-10.7-11.9V59.7c0-5.8,4.6-10.6,10.2-10.6M456.8,42c-9.5,0-17.2,7.9-17.2,17.6v194.1c0,9.4,7.2,17.1,16.5,18.8,69.1,12.8,122.7,69.7,130.5,140.3,1.1,9.9,9.1,18,19,18h193c9.9,0,18-8.1,17.6-18-8.9-196.5-163.3-355.1-358-370.7h-1.4v-.1Z"
						/>
					</g>
				</g>
				<g id="nice-text">
					<path
						class="cls-2"
						d="M587.7,231.4c-.7.9-1.6.6-2.7-.2-2.1-1.6-4.4-5.6-4-7,.5-2,6.9-35.7,6.9-35.7-5.4,5.4-11.1,11.7-16,18.5-2.1,2.9-3.8,6-5.8,8.8-.4.6-1.4.8-2.3.2-1.4-1-4.6-8.6-2.3-12.1,1.6-2.4,3.5-5.1,5.7-8,8.2-11.2,19.6-25.4,26.7-33.2,3.1-3.4,7.5-2.2,10.1-.4,1.3.9,2.1,2,1.9,2.7-.5,2.2-8.7,39.6-8.7,39.6,1.8-3,3.9-6,6.1-9.1,6.7-9.1,14.3-17.8,17.6-21.1,1-1,2-1.1,2.9-.5,2.3,1.7,5.3,8,3.8,10.2,0,0,0,.1-.1.2-11.1,10.6-30,34.8-39.6,47l-.2.1Z"
					/>
					<path
						class="cls-2"
						d="M599.2,242c-1.5-1.4-2.4-3-1.7-4.4,4.4-8.2,13.3-18.9,19.6-25.5,8.9-9.3,16.3-15.2,20.5-17.4,1.3-.7,2.5,0,3.6,1,2.6,2.4,3.4,7.7.6,10.7-2.6,2.7-11.4,10.7-16.2,15.7-4.5,4.7-16,17-20.2,23-.6.6-3.7-.6-6.2-3v-.1Z"
					/>
					<path
						class="cls-2"
						d="M618.2,263.7c-5.9-7.1-3.7-22.2,10.6-34,15.3-12.7,36.3-15.4,44.2-5.9,6.8,8.2,0,17.3-7.7,23.6-2.2,1.8-4.4,3-7.5-.8-2.6-3.1-4.5-7.7-3.2-8.8.1-.1.2-.2.4-.2,4-1.6,8.6-3.7,10.8-5.5,1.2-1,1.7-1.9,1.1-2.7-2-2.5-17.3-1.7-29.7,8.6-7.8,6.4-12.1,15.5-7.8,20.6,4,4.9,13,4.7,17.9,2.8.3-.1.8,0,1.1.5.8.9,1.3,2.9-.2,4.1-.2.2-.4.3-.7.4-10.8,5.2-23.2,4.8-29.4-2.7h.1Z"
					/>
					<path
						class="cls-2"
						d="M666.9,306.2c-1,.6-2.1,1-3.3.7-10.3-2.4-20.3-9.4-23-14-1.8-3.1-1.7-10.4-.3-11.8,5.2-5.1,11.6-9.5,18.1-13.5-.6-3.4,2.8-6.6,4.8-7.9,1.5-.9,2.2-.3,3.1,1.2.3.5.6,1,.7,1.4,9.3-5.2,16.5-8,20.7-8.8,3.2-.6,8.6,7.6,12.4,14,2,3.4,3.5,6.3,3.9,7.3,1.1,2.6-.3,7.8-2.5,9.1-.8.5-1.7.3-2.5-.9-2.6-3.9-9.7-13.5-13-15.8-3.3,1.5-8,4.1-12.3,6.4.1.2.2.4.4.7,2.3,3.9,6.8,8.1,11,11.6v.1c.5.8-.7,2.5-2.2,3.3-5.7,3.3-14.8-6.8-18.2-10.6-3.7,2.1-10,6.3-14.4,9,4.3,6.1,13.8,12.7,18.7,15.1h.1c.1.2,0,.5-.1.9-.2.6-1.2,1.6-2.4,2.3l.3.2Z"
					/>
				</g>
			</g>
			<g id="naughty-panel" :style="naughtyPanelStyle">
				<g>
					<path
						class="cls-9"
						d="M414.6,59.6c0-10.2-8.4-18.3-18.5-17.6C200.9,57.1,46,215.9,37,412.8c-.5,9.9,7.7,18,17.6,18h193c9.9,0,17.9-8.1,19-18,7.9-71,61.9-128,131.4-140.5,9.3-1.7,16.6-9.4,16.6-18.8V59.5v.1Z"
					/>
					<g class="cls-11">
						<path
							class="cls-6"
							d="M397.4,49c5.6,0,10.2,4.8,10.2,10.6v194c0,5.8-4.6,10.8-10.8,11.9-17.8,3.2-35,9.2-50.9,18-15.6,8.5-29.6,19.4-41.8,32.4-12.2,13-22.2,27.8-29.8,43.9-7.7,16.5-12.7,34.2-14.7,52.3-.7,6.7-5.9,11.7-12,11.7H54.6c-3,0-5.8-1.2-7.8-3.3-1.9-2-2.9-4.6-2.8-7.4C52.8,220.4,204.3,63.8,396.6,48.9h.8M397.4,42h-1.3C200.9,57.1,46,215.9,37,412.8c-.5,9.9,7.7,18,17.6,18h193c9.9,0,17.9-8.1,19-18,7.9-71,61.9-128,131.4-140.5,9.3-1.7,16.6-9.4,16.6-18.8V59.5c0-9.7-7.7-17.6-17.2-17.6h0v.1Z"
						/>
					</g>
				</g>
				<g id="flames" class="cls-11">
					<path
						class="cls-10"
						d="M407.6,224.5c-14.8-8.6-34-12.9-48.5-19.3-20.9-9.1-34.4-22.1-45.4-41.9-.9-1.7-1.7-3.5-2.6-5.2-.1-.2-.3-.5-.4-.1-.1.3.5,5.5.6,6.3,1.4,11.5,3.8,23.6,7,34.8,6.5,22.8,15.6,38.4,34.4,53.4.8.6,1.5,1.3,2.3,1.8,0,.1-2,.5-2.2.5-19.4,3.2-42.6-16-52.9-30.7-15.6-22.4-18.1-51.3-39.3-70-13.6-12-33.4-21.3-51.8-20.1-.4,0-4.3.3-4.3.7.3.6.9.6,1.3.9,24.9,17.4,53.9,45.9,55.3,78.1.3,6.2-.4,12.2.2,18.5,2,23.3,13.3,47.6,33.2,60.9,5.1,3.4,10.4,4.8,16,7.1,1.8.8,4.3,1.8,7,3.2,8.9-7.6,18.5-14.3,28.7-20,15.9-8.7,33-14.8,50.9-18,2-.3,3.7-1.1,5.3-2.1.1-.2.2-.3.4-.4h0c3.1-2.3,5.1-5.7,5.1-9.5v-29.1l-.3.2Z"
					/>
					<path
						class="cls-10"
						d="M259.6,412.1c.9-8.4,2.5-16.7,4.7-24.8-2.2-1.8-3.6-4.7-4.9-7-6.3-12-9.5-22.3-22.3-29.4-6-3.4-12.9-4.8-19.6-5.4-.9.3,1,.9,1.2,1,11.2,6.1,23.3,16.5,20.9,30.5-1.5,9-2.9,15.9,1.5,24.6.3.5,1.7,2.7,1.6,2.9-16.4,5.4-25.8-13.2-30-25.9-1.2-3.7-2-7.6-3.4-11.2-9.1-24.2-32.6-38.9-56.6-45.3-1.3-.4-2.8-.7-4.1-.9,0,.2.3.5.5.6,1.2.8,3.5,1.6,4.9,2.3,20.9,11.2,37.2,30.7,36.5,55.3-.2,7.6-3,15-2.3,22.7.8,8.6,4.6,15.9,10.2,21.7h49.2c6.1,0,11.3-5,12-11.7h0Z"
					/>
					<path
						class="cls-10"
						d="M297,321.7c-8.5-7.3-11.8-18.3-18.9-26.7-9.6-11.4-22-20.3-37.3-20.2-2.8,0-5.4.6-8.2.8-11.2.9-21.1-3.2-29.3-10.8-1.8-1.7-3.1-3.8-4.7-5.7-.1.2,0,.5,0,.7.3.8,1.1,2.3,1.6,3.2,3.6,6.8,9.4,15.2,15.9,19.3,4.9,3.1,10.6,3.1,16.2,4.3,13,2.6,25.3,7.1,31.9,19.6,2.9,5.6,3.8,11.9,4.1,18.1l-.2.3c-5.7-8.5-13.8-15.4-23.6-18.4-8.9-2.8-15-1.7-23.9-.4-29.7,4.4-55.9-30.1-64.2-55.2-.3-1-.4-2.2-1-3.1-.3,0-.5,2.1-.6,2.4-3.2,19.7,3.2,43.1,16.2,58.3,13.7,16,30.5,24.8,50.3,30.5,13.2,3.8,31.6,6.2,41.9,15.8,2.8,2.7,6.1,6.2,8.8,10.2.7-1.7,1.4-3.3,2.2-5,6.3-13.4,14.3-25.9,23.8-37.2l-1.1-.9.1.1Z"
					/>
				</g>
				<g id="naughty-text">
					<g>
						<path
							class="cls-2"
							d="M143.1,355.1l24.9,7.4,5.6-6.7,2.5,13.4-6.8,6.7-27.5-8.1-6.5,5.7-2.9-12,8.1-7.2-2.6-10.8,10-13.9,26.9,8.2,5-6,3.1,12.6-7,7.2-25.6-7.9-7.1,11.2-.1.2Z"
						/>
						<path
							class="cls-2"
							d="M151.7,302.1l13.7-16.2,26.8,13.2,7-5.3.4,13.2-8.4,5.7-10.6-5.1-5.4,11.5,4.2,7.1,7.1-6.4,1.8,11.6-9.8,7.7-17.7-33.2-9.1,11.1-.2-14.8.2-.1ZM171.7,312.7l3.8-8.1-10.7-5.3,6.8,13.4h.1Z"
						/>
						<path
							class="cls-2"
							d="M213.2,284.9l-12.3,8-22.7-16.9-8.5,3.5,1.6-13,9.8-3.9,22.5,16.7,10.3-7.7-21.5-15.6-8.5,3.5,1.6-13,9.8-3.9,23.1,16.8,8.1-5-2.2,14.7-8.7,3.9-2.4,12v-.1Z"
						/>
						<path
							class="cls-2"
							d="M245,240.4l-3.3,9.3-13.7,5.1-19.8-20.4,5.4-20.5,15-10.1v11.7l-12.8,8.1,17.2,17.9,8.8-4.2-7.9-8.3,5.2-12.7,19.7,20.6-5,12.9-8.8-9.2v-.2Z"
						/>
						<path
							class="cls-2"
							d="M261.2,206.7l5,7.4,9.1-1.8-6.7,12.8-9.5.7-15.9-24-9.1.4,5.9-11.7,10.5-.3,7.3,10.9,13-9.1-4.5-6.8-9.7.6,7.1-11.4,10.2.2,15.9,23.7,8.7-1.1-6.3,11.6-10.1.7-7.9-11.8-13,9.1v-.1Z"
						/>
						<path
							class="cls-2"
							d="M292.4,167.4l-12.5,5.7,2.6-10.1,33.1-14.9-2.7,10.4-9.1,3.9,10.4,23.5,9.3-.3-8.7,11.5-9.5-.9-12.7-28.9-.2.1Z"
						/>
						<path
							class="cls-2"
							d="M332.8,180l-6.5-24.8-8.8-2.5,9.3-9.2,10.2,3.1,6.4,24.2,12.8.4-6.3-22.9-8.8-2.6,9.4-9.1,10.1,3,6.8,24.7,4.5,12.2-16.2,15.4-21-2.4,8.8-8.6-10.6-1-.1.1ZM347.5,180.9l13.1,1.9-3.7-9.5-9.4,7.6Z"
						/>
					</g>
				</g>
			</g>
			<g id="needle" :style="needleStyle">
				<circle class="cls-3" cx="429.89" cy="449.34" r="81.8" />
				<polygon class="cls-4" points="425.61 105.62 395.86 449.79 463.85 448.96 425.61 105.62" />
				<circle class="cls-5" cx="429.89" cy="449.34" r="53.2" />
			</g>
		</g>
	</svg>
</template>

<style scoped>
.cls-1 {
	fill-rule: evenodd;
}

.cls-1,
.cls-2 {
	fill: #fff;
}

.cls-3 {
	fill: #484646;
}

.cls-3,
.cls-4,
.cls-5 {
	stroke: #111827;
}

.cls-3,
.cls-5 {
	stroke-miterlimit: 10;
	stroke-width: 11px;
}

.cls-6 {
	fill: #111827;
}

.cls-7 {
	fill: #4e9b0d;
}

.cls-8 {
	fill: #2d292d;
}

.cls-9 {
	fill: #ed1c24;
}

.cls-4 {
	stroke-linejoin: bevel;
	stroke-width: 12px;
}

.cls-4,
.cls-10 {
	fill: #fff200;
}

.cls-5 {
	fill: #625f5f;
}

.cls-11 {
	opacity: 0.3;
}
</style>
